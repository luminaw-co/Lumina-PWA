---
import Button from "@/components/ui/Button.astro";
import Container from "@/components/ui/Container.astro";
import TitleUI from "@/components/ui/TitleUI.astro";
import { iconsSrc } from "@/components/layout/BaseNavBar.astro";
---

<section
	aria-label="Agendar llamada"
	class="relative w-full max-w-[1424px] min-h-[100dvh] py-12 rounded-b-[20px] px-6 mx-auto overflow-hidden bg-gradient-to-t from-[var(--brand-blue)] to-[var(--bg-page)] mt-4"
>
	<Container id="hero-grid-bg" class="grid-bg opacity-32" />
	<Container
		class="max-w-[440px] w-full rounded-[var(--radius-lg)] p-6 flex flex-col items-center gap-5 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[2]"
	>
		<TitleUI
			title="Agendar llamada"
			subtitle="Conversemos sobre tu proyecto."
		/>
		<img
			src={`${iconsSrc.isometrics}contact-isometric.svg`}
			alt="Contact Illustration"
			class="w-full max-w-[220px] h-auto block object-contain rounded-[var(--radius-lg)] mb-2 animate-floatY"
			width="220"
			height="160"
			loading="lazy"
		/>
		<form
			id="contactForm"
			class="w-full flex flex-col gap-5 items-center relative"
			autocomplete="off"
			action="/api/submit-contact"
			method="post"
		>
			<div class="w-full flex flex-col gap-1">
				<label for="name" class="text-xs-left">Nombre</label>
				<input
					id="name"
					type="text"
					name="name"
					required
					placeholder="¿Cómo te llamas?"
					class="input-form"
					autocomplete="name"
					style="background: var(--bg-card); color: var(--text-primary); border-radius: var(--radius-md);"
				/>
			</div>
			<div class="w-full flex flex-col gap-1">
				<label for="email" class="text-xs-left"
					>Correo electrónico</label
				>
				<input
					id="email"
					type="email"
					name="email"
					required
					placeholder="¿Dónde te escribimos?"
					class="input-form"
					autocomplete="email"
					style="background: var(--bg-card); color: var(--text-primary); border-radius: var(--radius-md);"
				/>
			</div>
			<div class="w-full flex flex-col gap-1">
				<label for="phone" class="text-xs-left">
					Teléfono <span class="text-xs">(opcional)</span>
				</label>
				<input
					id="phone"
					type="tel"
					name="phone"
					placeholder="¿Prefieres WhatsApp o llamada?"
					class="input-form"
					autocomplete="tel"
					style="background: var(--bg-card); color: var(--text-primary); border-radius: var(--radius-md);"
				/>
			</div>
			<input type="hidden" name="source" value="contact-page" />
			<Button
				type="submit"
				icon="ui/send-email-white"
				text="Agendar llamada"
				class="text-[var(--button-sm)] mt-2"
			/>
			<p class="text-xs-left !text-center mt-1">
				Te contactaremos en menos de 24 horas.
			</p>
			<div
				id="modalStatus"
				class="w-full mt-2 transition-all duration-500 ease-in-out opacity-0 scale-95 pointer-events-none absolute left-0"
				style="top:100%;"
			>
				<span
					id="modalMessage"
					class="block w-full px-4 py-3 rounded-lg bg-[var(--status-success)] text-[var(--text-dark)] shadow-lg text-center"
				></span>
			</div>
		</form>
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				const form = document.getElementById("contactForm");
				const modal = document.getElementById("modalStatus");
				const modalMsg = document.getElementById("modalMessage");

				if (!form || !modal || !modalMsg) return;

				let timeoutId = null;
				function showModal(message, success = true) {
					modalMsg.textContent = message;
					modal.classList.remove(
						"opacity-0",
						"scale-95",
						"pointer-events-none",
					);
					modal.classList.add(
						"opacity-100",
						"scale-100",
						"pointer-events-auto",
					);
					modalMsg.style.background = success
						? "var(--status-success)"
						: "var(--status-error)";
					modalMsg.style.color = "var(--text-dark)";
					if (timeoutId) clearTimeout(timeoutId);
					timeoutId = setTimeout(hideModal, 4000);
				}
				function hideModal() {
					modal.classList.remove(
						"opacity-100",
						"scale-100",
						"pointer-events-auto",
					);
					modal.classList.add(
						"opacity-0",
						"scale-95",
						"pointer-events-none",
					);
				}

				form.addEventListener("submit", async function (e) {
					e.preventDefault();
					const formData = new FormData(form);

					try {
						const response = await fetch(
							form.getAttribute("action") ||
								"/api/submit-contact",
							{
								method: "POST",
								body: formData,
							},
						);
						if (response.ok) {
							showModal(
								"¡Formulario enviado correctamente!",
								true,
							);
							if (typeof form.reset === "function") form.reset();
						} else {
							showModal(
								"Error al enviar el formulario. Intenta de nuevo.",
								false,
							);
						}
					} catch {
						showModal(
							"Error de conexión. Intenta de nuevo.",
							false,
						);
					}
				});
			});
		</script>
	</Container>
</section>
