---
import Link from "@/components/ui/Link.astro";
import Container from "@/components/ui/Container.astro";
import Icon from "@/components/ui/Icon.astro";
import Button from "@/components/ui/Button.astro";
import LastUpdate from "@/components/ui/LastUpdate.astro";
import {
	serviceLinks,
	iconsSrc,
	enterpriseRoute,
	links,
} from "@/components/layout/BaseNavBar.astro";

const year = new Date().getFullYear();

export const email = "contact@luminaw.co";

const legalRoute = "/legal/";

const recursosLinks = [
	{ href: "/blog", label: "Blog tÃ©cnico" },
	{ href: `${enterpriseRoute}culture`, label: "Cultura de equipo" },
	{ href: `${enterpriseRoute}jobs`, label: "Trabaja con nosotros" },
];

const legalLinks = [
	{ href: `${legalRoute}conditions`, label: "TÃ©rminos y condiciones" },
	{ href: `${legalRoute}privacy`, label: "PolÃ­tica de privacidad" },
	{ href: `${legalRoute}cookies`, label: "PolÃ­tica de cookies" },
	{ href: `${legalRoute}faq`, label: "Preguntas frecuentes" },
];

const socialLinks = [
	{
		href: "https://www.instagram.com/luminaw.co",
		icon: `${iconsSrc.social}instagram.svg`,
		label: "Instagram",
	},
	{
		href: "https://www.linkedin.com/company/lumina-w",
		icon: `${iconsSrc.social}linkedin.svg`,
		label: "LinkedIn",
	},
	{
		href: "https://wa.me/573108283088?text=Hola%2C%20me%20gustar%C3%ADa%20cotizar%20un%20servicio%2C%20por%20favor",
		icon: `${iconsSrc.social}whatsapp.svg`,
		label: "WhatsApp",
	},
];
---

<footer class="base-footer !flex-col items-center !gap-10">
	<Container class="flex flex-col gap-10 w-full 2xl:flex-row">
		<nav aria-label="Footer" class="flex flex-wrap gap-5 w-full text-left">
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start">Empresa</p>
				<ul class="flex flex-col">
					{
						links
							.filter(
								(l) =>
									l.href === "/" ||
									l.href === `${enterpriseRoute}us` ||
									l.href === `${enterpriseRoute}cases` ||
									l.href === `${enterpriseRoute}contact`,
							)
							.map((l) => (
								<li>
									<Link
										href={l.href}
										class="text-[12px] !text-left"
									>
										{l.label}
									</Link>
								</li>
							))
					}
				</ul>
			</Container>
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start">Servicios</p>
				<ul class="flex flex-col">
					{
						serviceLinks.map((s) => (
							<li>
								<Link
									href={`${s.href}`}
									class="text-[12px] !text-left"
								>
									{s.label}
								</Link>
							</li>
						))
					}
				</ul>
			</Container>
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start">Recursos</p>
				<ul class="flex flex-col">
					{
						recursosLinks.map((l) => (
							<li>
								<Link
									href={l.href}
									class="text-[12px] !text-left"
								>
									{l.label}
								</Link>
							</li>
						))
					}
				</ul>
			</Container>
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start mb-2">Legal</p>
				<ul class="flex flex-col">
					{
						legalLinks.slice(0, 3).map((link) => (
							<li>
								<Link
									href={link.href}
									class="text-[12px] !text-left"
								>
									{link.label}
								</Link>
							</li>
						))
					}
				</ul>
			</Container>
			<Container
				class="min-w-fit flex-1 md:justify-items-center xl:justify-items-start 2xl:content-start 2xl:m-0"
			>
				<p class="heading-3 !text-start">SÃ­guenos</p>
				<ul class="flex justify-start gap-3">
					{
						socialLinks.map((s) => (
							<li>
								<Link
									href={s.href}
									target="_blank"
									rel="noopener noreferrer"
									aria-label={s.label}
									class="inline-block !p-0"
								>
									<Icon
										src={s.icon}
										alt={s.label}
										class="w-[22px]"
										size="md"
									/>
								</Link>
							</li>
						))
					}
				</ul>
				<p class="text-sm-left mt-5">
					Â¿Listo para empezar tu proyecto? <br /> Conversemos:
					<Link
						href={`mailto:${email}`}
						class="!lowercase !p-0"
						target="_blank"
						rel="noopener noreferrer"
					>
						{email}
					</Link>
				</p>
			</Container>
		</nav>
		<Container
			class="content-center w-full justify-items-center md:max-w-[520px] m-auto 2xl:content-start 2xl:justify-items-start 2xl:m-0"
		>
			<p class="heading-3 !text-start">
				SuscrÃ­bete a las novedades de LÃºmina
			</p>
			<div class="md:p-3 flex flex-col gap-3 md:max-w-[520px] w-full">
				<p class="text-sm-center 2xl:text-left">
					Nuevos servicios, guÃ­as tÃ©cnicas y casos reales. Sin spam.
				</p>
				<form
					class="md:max-w-[520px] w-full flex flex-row gap-2"
					autocomplete="off"
					method="POST"
					action="https://app.loops.so/api/newsletter-form/cmiq9zksu0550zx0jpay8zjdv"
					data-no-loader="true"
				>
					<input
						type="email"
						name="email"
						required
						placeholder="Tu correo electrÃ³nico"
						class="input-form"
						autocomplete="email"
					/>
					<Button
						type="submit"
						icon="ui/send-email-white"
						text="Suscribirme"
						class="text-[14px]"
						data-no-loader="true"
						showLoader={false}
					/>
				</form>
				<div
					id="newsletterModalStatus"
					class="w-full mt-2 flex align-self-center transition-all duration-500 ease-in-out opacity-0 scale-95 pointer-events-none"
				>
					<span
						id="newsletterModalMessage"
						class="block w-full px-4 py-3 rounded-lg bg-[var(--status-success)] text-[var(--text-dark)] shadow-lg text-center"
					></span>
				</div>
			</div>
		</Container>
	</Container>
	<Container class="w-full flex flex-col items-center">
		<p class="text-xs-left">
			Con ðŸ’™ desde MedellÃ­n, Colombia para el mundo.
		</p>
		<LastUpdate />
		<div class="inline-flex-center gap-16 mt-5">
			<span class="text-body-xs text-[var(--text-primary)]">
				Â© LÃºmina {year}
			</span>
		</div>
	</Container>
</footer>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		const form = document.querySelector(
			'form[action="https://app.loops.so/api/newsletter-form/cmiq9zksu0550zx0jpay8zjdv"]',
		);
		const modal = document.getElementById("newsletterModalStatus");
		const modalMsg = document.getElementById("newsletterModalMessage");

		if (
			!(form instanceof HTMLFormElement) ||
			!(modal instanceof HTMLElement) ||
			!(modalMsg instanceof HTMLElement)
		)
			return;

		let timeoutId = null;
		function showNewsletterModal(message, success = true) {
			modalMsg.textContent = message;
			modal.classList.remove(
				"opacity-0",
				"scale-95",
				"pointer-events-none",
			);
			modal.classList.add(
				"opacity-100",
				"scale-100",
				"pointer-events-auto",
			);
			modalMsg.style.background = success
				? "var(--status-success)"
				: "var(--status-error)";
			modalMsg.style.color = "var(--text-dark)";
			if (timeoutId) clearTimeout(timeoutId);
			timeoutId = setTimeout(hideNewsletterModal, 4000);
		}
		function hideNewsletterModal() {
			modal.classList.remove(
				"opacity-100",
				"scale-100",
				"pointer-events-auto",
			);
			modal.classList.add("opacity-0", "scale-95", "pointer-events-none");
		}

		form.addEventListener("submit", async function (e) {
			e.preventDefault();

			const formData = new FormData(form);
			const params = new URLSearchParams();
			for (const [key, value] of formData.entries()) {
				params.append(
					key,
					typeof value === "string" ? value : String(value),
				);
			}

			try {
				const response = await fetch(form.action, {
					method: "POST",
					body: params,
					headers: {
						"Content-Type": "application/x-www-form-urlencoded",
					},
				});
				if (response.ok) {
					showNewsletterModal(
						"Â¡SuscripciÃ³n exitosa! Revisa tu bandeja de entrada.",
						true,
					);
					if (typeof form.reset === "function") form.reset();
				} else {
					showNewsletterModal(
						"Error al suscribirte. Intenta de nuevo.",
						false,
					);
				}
			} catch {
				showNewsletterModal(
					"Error de conexiÃ³n. Intenta de nuevo.",
					false,
				);
			}
		});
	});
</script>
