---
import Link from "@/components/ui/Link.astro";
import Container from "@/components/ui/Container.astro";
import Icon from "@/components/ui/Icon.astro";
import Button from "@/components/ui/Button.astro";
import {
	serviceLinks,
	iconsSrc,
	enterpriseRoute,
	links,
} from "@/components/layout/BaseNavBar.astro";

const year = new Date().getFullYear();

export const email = "contact@luminaw.co";

const slogan =
	"Si no se entiende, no sirve. DiseÃ±amos y desarrollamos para que las cosas simplemente tengan sentido.";

const legalRoute = "/legal/";

const recursosLinks = [
	{ href: "/blog", label: "Blog tÃ©cnico" },
	{ href: `${enterpriseRoute}culture`, label: "Cultura de equipo" },
	{ href: `${enterpriseRoute}jobs`, label: "Trabaja con nosotros" },
];

const legalLinks = [
	{ href: `${legalRoute}conditions`, label: "TÃ©rminos y condiciones" },
	{ href: `${legalRoute}privacy`, label: "PolÃ­tica de privacidad" },
	{ href: `${legalRoute}cookies`, label: "PolÃ­tica de cookies" },
	{ href: `${legalRoute}faq`, label: "Preguntas frecuentes" },
];

const socialLinks = [
	{
		href: "https://www.linkedin.com/company/luminaw",
		icon: `${iconsSrc.social}linkedin.svg`,
		label: "LinkedIn",
	},
	{
		href: "https://github.com/luminaw",
		icon: `${iconsSrc.social}github.svg`,
		label: "GitHub",
	},
	{
		href: "https://www.instagram.com/luminaw",
		icon: `${iconsSrc.ui}see-demo.svg`,
		label: "Instagram",
	},
];
---

<footer class="base-footer !flex-col items-center !gap-10">
	<Container class="flex flex-col gap-10 w-full 2xl:flex-row">
		<nav aria-label="Footer" class="flex flex-wrap gap-5 w-full text-left">
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start">Empresa</p>
				<ul class="flex flex-col">
					{
						links
							.filter(
								(l) =>
									l.href === "/" ||
									l.href === `${enterpriseRoute}us` ||
									l.href === `${enterpriseRoute}cases` ||
									l.href === `${enterpriseRoute}contact`,
							)
							.map((l) => (
								<li>
									<Link
										href={l.href}
										class="text-[12px] !text-left"
									>
										{l.label}
									</Link>
								</li>
							))
					}
				</ul>
			</Container>
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start">Servicios</p>
				<ul class="flex flex-col">
					{
						serviceLinks.map((s) => (
							<li>
								<Link
									href={`${s.href}`}
									class="text-[12px] !text-left"
								>
									{s.label}
								</Link>
							</li>
						))
					}
				</ul>
			</Container>
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start">Recursos</p>
				<ul class="flex flex-col">
					{
						recursosLinks.map((l) => (
							<li>
								<Link
									href={l.href}
									class="text-[12px] !text-left"
								>
									{l.label}
								</Link>
							</li>
						))
					}
				</ul>
			</Container>
			<Container class="min-w-fit flex-1">
				<p class="heading-3 !text-start mb-2">Legal</p>
				<ul class="flex flex-col">
					{
						legalLinks.slice(0, 3).map((link) => (
							<li>
								<Link
									href={link.href}
									class="text-[12px] !text-left"
								>
									{link.label}
								</Link>
							</li>
						))
					}
				</ul>
			</Container>
			<Container
				class="min-w-fit flex-1 md:justify-items-center xl:justify-items-start 2xl:content-start 2xl:m-0"
			>
				<p class="heading-3 !text-start">SÃ­guenos</p>
				<ul class="flex justify-start gap-3">
					{
						socialLinks.map((s) => (
							<Icon
								href={s.href}
								target="_blank"
								rel="noopener noreferrer"
								aria-label={s.label}
								class="w-[22px]"
							>
								<img src={s.icon} alt={s.label} />
							</Icon>
						))
					}
				</ul>
				<p class="text-sm-left mt-5">
					Â¿Listo para empezar tu proyecto? <br /> Conversemos: <Link
						href={`mailto:${email}`}
						class="text-[16px] !lowercase font-normal text-left !p-0"
						>{email}</Link
					>
				</p>
			</Container>
		</nav>
		<Container
			class="content-center w-full justify-items-center max-w-[520px] m-auto 2xl:content-start 2xl:justify-items-start 2xl:m-0"
		>
			<p class="heading-3 !text-start">
				SuscrÃ­bete a las novedades de LÃºmina
			</p>
			<div class="p-3 flex flex-col gap-3 max-w-[520px] w-full">
				<p class="text-sm-center 2xl:text-left">
					Nuevos servicios, guÃ­as tÃ©cnicas y casos reales. Sin spam.
				</p>
				<form
					class="max-w-[520px] w-full flex flex-row gap-2"
					autocomplete="off"
					method="POST"
					action="https://app.loops.so/api/newsletter-form/cmiq9zksu0550zx0jpay8zjdv"
				>
					<input
						type="email"
						name="email"
						required
						placeholder="Tu correo electrÃ³nico"
						class="input-form"
						autocomplete="email"
					/>
					<Button
						type="submit"
						icon="ui/send-email-white"
						text="Suscribirme"
						class="text-[14px]"
					/>
				</form>
			</div>
		</Container>
	</Container>
	<Container class="w-full flex flex-col items-center">
		<p class="text-xs-left">
			Con ðŸ’™ desde MedellÃ­n, Colombia para el mundo.
		</p>
		<div class="inline-flex-center gap-16 mt-5">
			<!--{
				links
					.filter((l) => l.label === "Inicio")
					.map((l) => (
						<a
							href={l.href}
							aria-label={l.label}
							class="flex items-center gap-3"
						>
							{iconsSrc.brand ? (
								<a>
									<img
										src={`${iconsSrc.brand}lumina-logo-light.svg`}
										alt="LÃºmina"
										class="h-32 dark:hidden"
									/>
									<img
										src={`${iconsSrc.brand}lumina-logo-dark.svg`}
										alt="LÃºmina"
										class="h-32 hidden dark:block"
									/>
								</a>
							) : null}
						</a>
					))
		}-->
			<span class="text-body-xs text-[var(--text-primary)]">
				Â© LÃºmina {year}
			</span>
		</div>
	</Container>
	<div
		id="modalStatus"
		class="w-full mt-2 transition-all duration-500 ease-in-out opacity-0 scale-95 pointer-events-none"
	>
		<span
			id="modalMessage"
			class="block w-full px-4 py-3 rounded-lg bg-[var(--status-success)] text-[var(--text-dark)] shadow-lg text-center"
		></span>
	</div>
</footer>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		const form = document.querySelector(
			'form[action="https://app.loops.so/api/newsletter-form/cmiq9zksu0550zx0jpay8zjdv"]',
		);
		const modal = document.getElementById("modalStatus");
		const modalMsg = document.getElementById("modalMessage");

		if (!form || !modal || !modalMsg) return;

		let timeoutId = null;
		function showModal(message, success = true) {
			modalMsg.textContent = message;
			modal.classList.remove(
				"opacity-0",
				"scale-95",
				"pointer-events-none",
			);
			modal.classList.add(
				"opacity-100",
				"scale-100",
				"pointer-events-auto",
			);
			modalMsg.style.background = success
				? "var(--status-success)"
				: "var(--status-error)";
			modalMsg.style.color = "var(--text-dark)";
			if (timeoutId) clearTimeout(timeoutId);
			timeoutId = setTimeout(hideModal, 4000);
		}
		function hideModal() {
			modal.classList.remove(
				"opacity-100",
				"scale-100",
				"pointer-events-auto",
			);
			modal.classList.add("opacity-0", "scale-95", "pointer-events-none");
		}

		form.addEventListener("submit", async function (e) {
			e.preventDefault();
			const formData = new FormData(form);
			const params = new URLSearchParams();
			for (const [key, value] of formData.entries()) {
				params.append(key, value);
			}
			try {
				const response = await fetch(form.action, {
					method: "POST",
					body: params,
					headers: {
						"Content-Type": "application/x-www-form-urlencoded",
					},
				});
				if (response.ok) {
					showModal("Â¡SuscripciÃ³n exitosa!", true);
					if (typeof form.reset === "function") form.reset();
				} else {
					showModal("Error al suscribirte. Intenta de nuevo.", false);
				}
			} catch {
				showModal("Error de conexiÃ³n. Intenta de nuevo.", false);
			}
		});
	});
</script>
