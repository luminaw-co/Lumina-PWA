---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Link from "../../components/ui/Link.astro";
import Icon from "../../components/ui/Icon.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("projects");
  return entries.map((entry) => ({
    params: { slug: entry.slug },
  }));
}

const { slug } = Astro.params;
const entry = await getEntry("projects", slug);

if (!entry) {
  throw new Error("Proyecto no encontrado");
}

const { Content } = await entry.render();
const data = entry.data;
const cover = data.summary?.cover;
const note  = data.summary?.note;
---

<BaseLayout title={`${data.title}`}>
  <section class="px-6 md:px-8 pt-[80px] max-w-[80rem] mx-auto flex flex-col gap-6 mb-12">
    <header class="flex flex-col gap-5 items-center justify-center h-[350px] bg-gradient-to-b from-[var(--brand-blue)] to-[var(--bg-page)] rounded-lg px-6">
      <h1 class="heading-1 text-[var(--text-primary)]">{data.title}</h1>
      {data.subtitle && (
        <p class="text-body-xl font-bold text-[var(--border-base)]">{data.subtitle}</p>
      )}
      <p class="text-[var(--text-primary)] text-center">{data.briefText}</p>
      <div class="flex flex-col items-center gap-3 flex-wrap justify-end lg:justify-start">
        <div class="flex items-center gap-2">
          {data.links.github && (
            <Link href={data.links.github} target="_blank" rel="noopener" class="inline-flex items-center justify-center w-11 h-11 rounded-md text-[var(--accent-link)] hover:bg-[var(--accent-link)]/10">
              <Icon src="/icons/social/github.svg" size="md" />
            </Link>
          )}
          {data.links.demo && (
            <Link href={data.links.demo} target="_blank" rel="noopener" class="inline-flex items-center justify-center w-11 h-11 rounded-md text-[var(--accent-link)] hover:bg-[var(--accent-link)]/10">
              <Icon src="/icons/ui/see-demo.svg" size="md" />
            </Link>
          )}
        </div>
        <Link href="#more" class="text-[var(--accent-link)] hover:bg-[var(--accent-link)]/10">Saber más</Link>
      </div>
    </header>

    {cover && (
      <figure class="w-full max-w-[80rem] overflow-hidden">
        <img src={cover} alt={data.title} loading="lazy" decoding="async" class="w-full h-auto object-cover" />
        {note && <figcaption class="p-3 text-sm">{note}</figcaption>}
      </figure>
    )}

    <article class="prose prose-invert max-w-none" id="more">
      <Content />
    </article>

    <h2>Enlaces</h2>
    <p>
      Sitio web: <a href={data.links.demo} target="_blank" rel="noopener noreferrer">{data.links.demo}</a><br />
      Código: <a href={data.links.github} target="_blank" rel="noopener noreferrer">{data.links.github}</a>
    </p>
  </section>
</BaseLayout>